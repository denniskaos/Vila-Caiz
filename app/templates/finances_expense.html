{% extends "base.html" %}
{% block content %}
<section class="page-header">
  <h2>Despesas</h2>
  <p>Controle as saídas financeiras e mantenha um registo detalhado dos custos do clube.</p>
  {% if active_season %}
    <p class="season-note">Época ativa: <strong>{{ active_season.name }}</strong></p>
  {% endif %}
</section>
<section class="section-grid">
  <article class="card form-card" aria-labelledby="form-expense">
    <h3 id="form-expense">{{ 'Editar Despesa' if editing_expense else 'Registar Despesa' }}</h3>
    <form method="post" action="{{ url_for('add_expense') }}">
      {% if editing_expense %}
        <input type="hidden" name="expense_id" value="{{ editing_expense.id }}" />
      {% endif %}
      <label for="expense-date">Data</label>
      <input id="expense-date" name="record_date" type="date" value="{{ editing_expense.record_date.isoformat() if editing_expense else '' }}" required />

      <label for="expense-description">Descrição</label>
      <input id="expense-description" name="description" type="text" value="{{ editing_expense.description if editing_expense else '' }}" required />

      <label for="expense-category">Categoria</label>
      <input id="expense-category" name="category" type="text" placeholder="Logística, Equipamentos..." value="{{ editing_expense.category if editing_expense else '' }}" required />

      <label for="expense-vendor">Fornecedor</label>
      <input id="expense-vendor" name="vendor" type="text" placeholder="Nome do fornecedor" value="{{ editing_expense.vendor if editing_expense else '' }}" />

      <label for="expense-amount">Montante (€)</label>
      <input id="expense-amount" name="amount" type="number" step="0.01" min="0" value="{{ editing_expense.amount if editing_expense else '' }}" required />

      <div class="form-actions">
        <button type="submit">{{ 'Atualizar' if editing_expense else 'Gravar' }}</button>
        {% if editing_expense %}
          <a href="{{ url_for('finances_expense_page') }}" class="button secondary">Cancelar</a>
        {% endif %}
      </div>
    </form>
  </article>

  <article class="card">
    <h3>Histórico de Despesas</h3>
    {% if expenses %}
      <div class="table-wrapper">
        <table aria-label="Lista de despesas">
          <thead>
            <tr>
              <th>Data</th>
              <th>Descrição</th>
              <th>Categoria</th>
              <th>Fornecedor</th>
              <th>Montante</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in expenses %}
              <tr>
                <td data-label="Data">{{ entry.record_date }}</td>
                <td data-label="Descrição">{{ entry.description }}</td>
                <td data-label="Categoria">{{ entry.category }}</td>
                <td data-label="Fornecedor">{{ entry.vendor or '-' }}</td>
                <td data-label="Montante">{{ entry.amount | format_currency }}</td>
                <td data-label="Ações">
                  <div class="actions">
                    <a href="{{ url_for('finances_expense_page', edit=entry.id) }}" class="button secondary">Editar</a>
                    <form method="post" action="{{ url_for('delete_expense', expense_id=entry.id) }}" class="inline-form">
                      <button type="submit" class="button danger" onclick="return confirm('Confirma a eliminação desta despesa?');">Eliminar</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="empty-state">Sem despesas registadas.</p>
    {% endif %}
  </article>
</section>
{% endblock %}
