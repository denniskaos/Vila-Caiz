{% extends "base.html" %}
{% block content %}
<section class="page-header">
  <h2>Camadas Jovens</h2>
  <p>Acompanhe a formação e a ligação às equipas técnicas.</p>
  {% if active_season %}
    <p class="season-note">Época ativa: <strong>{{ active_season.name }}</strong></p>
  {% endif %}
</section>
<section class="section-grid">
  <article class="card form-card" aria-labelledby="form-youth">
    <h3 id="form-youth">{{ 'Editar Equipa' if editing_team else 'Criar Equipa' }}</h3>
    <form method="post" action="{{ url_for('add_youth_team') }}">
      {% if editing_team %}
        <input type="hidden" name="team_id" value="{{ editing_team.id }}" />
      {% endif %}
      <label for="youth-name">Nome da Equipa</label>
      <input id="youth-name" name="name" type="text" value="{{ editing_team.name if editing_team else '' }}" required />

      <label for="youth-age">Escalão</label>
      <input id="youth-age" name="age_group" type="text" placeholder="Ex.: Sub-17" value="{{ editing_team.age_group if editing_team else '' }}" required />

      <label for="youth-coach">Treinador Responsável</label>
      <select id="youth-coach" name="coach_id">
        <option value="">Selecionar</option>
        {% set selected_coach = editing_team.coach_id if editing_team else '' %}
        {% for coach in coaches %}
          <option value="{{ coach.id }}"{% if coach.id == selected_coach %} selected{% endif %}>{{ coach.name }}</option>
        {% endfor %}
      </select>

      <div class="form-actions">
        <button type="submit">{{ 'Atualizar' if editing_team else 'Gravar' }}</button>
        {% if editing_team %}
          <a href="{{ url_for('youth_page') }}" class="button secondary">Cancelar</a>
        {% endif %}
      </div>
    </form>
  </article>

  <article class="card">
    <h3>Equipas em Atividade</h3>
    {% if youth_teams %}
      <div class="table-wrapper">
        <table aria-label="Lista de equipas de formação">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Escalão</th>
              <th>Treinador</th>
              <th>Atletas</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for team in youth_teams %}
              <tr>
                <td>{{ team.name }}</td>
                <td>{{ team.age_group }}</td>
                <td>{{ coach_lookup.get(team.coach_id, '—') }}</td>
                <td>{{ team.player_ids | length }}</td>
                <td>
                  <div class="actions">
                    <a href="{{ url_for('youth_page', edit=team.id) }}" class="button secondary">Editar</a>
                    <form method="post" action="{{ url_for('delete_youth_team', team_id=team.id) }}" class="inline-form">
                      <button type="submit" class="button danger" onclick="return confirm('Confirma a eliminação desta equipa?');">Eliminar</button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="empty-state">Sem equipas de formação registadas.</p>
    {% endif %}
  </article>
</section>
{% endblock %}
